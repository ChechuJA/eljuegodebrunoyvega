function registerGame(){
// Serpiente clásica con récord de longitud
const canvas=document.getElementById('gameCanvas'); const ctx=canvas.getContext('2d'); let af=null;
const SIZE=20, COLS=30, ROWS=20; canvas.width=COLS*SIZE; canvas.height=ROWS*SIZE+70;
let dir={x:1,y:0}; let snake=[{x:5,y:10},{x:4,y:10},{x:3,y:10}]; let food=spawn(); let score=0; let speed=160; let last=0; let gameOver=false; let high=Number(localStorage.getItem('snakeHigh')||0); let highName=localStorage.getItem('snakeHighName')||'-'; const playerName=localStorage.getItem('playerName')||'';
function spawn(){ return {x:Math.floor(Math.random()*COLS),y:Math.floor(Math.random()*ROWS)}; }
function update(t){ if(gameOver) return; if(!last) last=t; const d=t-last; if(d>speed){ last=t; const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y}; if(head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS|| snake.some(s=>s.x===head.x&&s.y===head.y)){ gameOver=true; if(score>high){ high=score; localStorage.setItem('snakeHigh', String(high)); } return;} snake.unshift(head); if(head.x===food.x&&head.y===food.y){ score+=10; speed=Math.max(60, speed-4); food=spawn(); } else snake.pop(); }
}
function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); if(window.GameUI) GameUI.softBg(ctx,canvas.width,canvas.height,['#e8f5e9','#c8e6c9']); if(window.GameUI){ GameUI.gradientBar(ctx,canvas.width,60,'#1b5e20','#2e7d32'); } else { ctx.fillStyle='#1b5e20'; ctx.fillRect(0,0,canvas.width,60);} ctx.fillStyle='#fff'; ctx.font='20px Arial'; ctx.fillText('Serpiente', 10,38); ctx.font='14px Arial'; ctx.fillText('Puntos: '+score, 160,24); ctx.fillText('Récord: '+high+' ('+highName+')', 160,44); for(let i=0;i<snake.length;i++){ const seg=snake[i]; const gx=seg.x*SIZE, gy=seg.y*SIZE+60; const g=ctx.createLinearGradient(gx,gy,gx+SIZE,gy+SIZE); if(i===0){ g.addColorStop(0,'#ffeb3b'); g.addColorStop(1,'#f57f17'); } else { g.addColorStop(0,'#66bb6a'); g.addColorStop(1,'#2e7d32'); } ctx.fillStyle=g; ctx.fillRect(gx,gy,SIZE,SIZE); ctx.strokeStyle='rgba(255,255,255,0.25)'; ctx.strokeRect(gx,gy,SIZE,SIZE); } ctx.fillStyle='#e91e63'; ctx.beginPath(); ctx.arc(food.x*SIZE+SIZE/2, food.y*SIZE+60+SIZE/2, SIZE/2.4,0,Math.PI*2); ctx.fill(); if(gameOver){ ctx.fillStyle='rgba(0,0,0,0.55)'; ctx.fillRect(0,60,canvas.width,canvas.height-60); ctx.fillStyle='#fff'; ctx.font='24px Arial'; ctx.textAlign='center'; ctx.fillText('FIN - R para reiniciar', canvas.width/2, canvas.height/2); } }
function loop(t){ update(t); draw(); af=requestAnimationFrame(loop); }
function key(e){ if(e.key==='ArrowLeft' && dir.x!==1) dir={x:-1,y:0}; else if(e.key==='ArrowRight'&&dir.x!==-1) dir={x:1,y:0}; else if(e.key==='ArrowUp'&&dir.y!==1) dir={x:0,y:-1}; else if(e.key==='ArrowDown'&&dir.y!==-1) dir={x:0,y:1}; else if(gameOver && e.key.toLowerCase()==='r'){ snake=[{x:5,y:10},{x:4,y:10},{x:3,y:10}]; dir={x:1,y:0}; score=0; speed=160; food=spawn(); gameOver=false; } }
window.addEventListener('keydown',key); requestAnimationFrame(loop);
return function cleanup(){ if(af) cancelAnimationFrame(af); window.removeEventListener('keydown',key); };
}
window.registerGame=registerGame;
